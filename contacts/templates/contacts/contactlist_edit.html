{# templates/contacts/contactlist_edit.html #}
{% extends "contacts/base_contacts.html" %}
{% load crispy_forms_tags %}

{% block content %}
<div class="container mt-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h2 class="mb-0">
      {% if object %}Edit Contact List{% else %}New Contact List{% endif %}
    </h2>
    <a href="{% url 'contacts:contactlist_list' %}" class="btn btn-outline-secondary">Back to Lists</a>
  </div>

  <!-- Form -->
  <div class="card shadow-sm mb-4">
    <div class="card-body">
      <form method="post" novalidate>
        {% csrf_token %}
        {{ form|crispy }}
        <div class="mt-3">
          <button type="submit" class="btn btn-primary">
            {% if object %}Save Changes{% else %}Create List{% endif %}
          </button>
          <a href="{% url 'contacts:contactlist_list' %}" class="btn btn-secondary">Cancel</a>
        </div>
      </form>
    </div>
  </div>

  <!-- Contacts grid -->
  <h4 class="mb-3">Contacts in this List</h4>
  <div class="card shadow-sm">
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table table-hover table-striped align-middle mb-0" id="contactsGrid">
          <thead class="bg-success-subtle">
            <tr class="text-success-emphasis">
              <th style="width:26%">Name</th>
              <th style="width:26%">Email</th>
              <th style="width:20%">Organization</th>
              <th>Description</th>
              <th style="width:140px" class="text-center">Actions</th>
            </tr>
          </thead>
          <tbody>
  {% if object %}
    {% for c in object.contacts.all %}
      <tr>
        <td class="fw-medium">{{ c.first_name }} {{ c.last_name }}</td>
        <td>
          {% if c.email %}
            <a href="mailto:{{ c.email }}">{{ c.email }}</a>
          {% else %}&nbsp;{% endif %}
        </td>
        <td>{{ c.organization|default_if_none:"" }}</td>
        <td>
          {% if c.description %}{{ c.description }}
          {% elif c.note %}{{ c.note }}
          {% elif c.job_title %}{{ c.job_title }}
          {% else %}-{% endif %}
        </td>
        <td class="text-center text-nowrap">
          <a href="{% url 'contacts:update' c.pk %}" class="btn btn-sm btn-outline-primary" title="Edit contact">
            <i class="fas fa-pen"></i>
          </a>
          <form method="post"
                action="{% url 'contacts:contactlist_remove_contact' object.pk c.pk %}"
                class="d-inline">
            {% csrf_token %}
            <button type="submit" class="btn btn-sm btn-outline-danger" title="Remove from list">
              <i class="fas fa-rotate-left"></i>
            </button>
          </form>
          <a href="{% url 'contacts:detail' c.pk %}" class="btn btn-sm btn-outline-secondary" title="View">
            <i class="fas fa-eye"></i>
          </a>
        </td>
      </tr>
    {% empty %}
      <tr>
        <td colspan="5" class="text-center text-muted py-3">No contacts in this list yet.</td>
      </tr>
    {% endfor %}
  {% else %}
    <tr>
      <td colspan="5" class="text-center text-muted py-3">No contacts in this list yet.</td>
    </tr>
  {% endif %}
</tbody>
        </table>
      </div>
    </div>
  </div>
</div>
{% endblock %}
